# Migration `20200420002856`

This migration has been generated by Anand Chowdhary at 4/20/2020, 12:28:56 AM.
You can check out the [state of the schema](./schema.prisma) after the migration.

## Database Steps

```sql
CREATE TABLE `staart`.`users` (
    `checkLocationOnLogin` boolean NOT NULL DEFAULT false ,
    `countryCode` varchar(191) NOT NULL DEFAULT 'us' ,
    `createdAt` datetime NOT NULL DEFAULT CURRENT_TIMESTAMP ,
    `gender` ENUM('MALE', 'FEMALE', 'NONBINARY', 'UNKNOWN') NOT NULL DEFAULT 'UNKNOWN' ,
    `id` int NOT NULL  AUTO_INCREMENT,
    `name` varchar(191) NOT NULL  ,
    `nickname` varchar(191) NOT NULL  ,
    `notificationEmails` ENUM('ACCOUNT', 'UPDATES', 'PROMOTIONS') NOT NULL DEFAULT 'ACCOUNT' ,
    `password` varchar(191)   ,
    `prefersColorScheme` ENUM('NO_PREFERENCE', 'LIGHT', 'DARK') NOT NULL DEFAULT 'NO_PREFERENCE' ,
    `prefersLanguage` varchar(191) NOT NULL DEFAULT 'en-us' ,
    `prefersReducedMotion` ENUM('NO_PREFERENCE', 'REDUCE') NOT NULL DEFAULT 'NO_PREFERENCE' ,
    `primaryEmail` int   ,
    `profilePicture` varchar(191) NOT NULL DEFAULT 'https://unavatar.now.sh/fallback.png' ,
    `role` ENUM('SUDO', 'USER') NOT NULL DEFAULT 'USER' ,
    `timezone` varchar(191) NOT NULL DEFAULT 'America/Los_Angeles' ,
    `twoFactorEnabled` boolean NOT NULL DEFAULT false ,
    `twoFactorSecret` varchar(191)   ,
    `updatedAt` datetime(3) NOT NULL  ,
    `username` varchar(191) NOT NULL  ,
    PRIMARY KEY (`id`)
)
DEFAULT CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci

CREATE TABLE `staart`.`organizations` (
    `autoJoinDomain` boolean NOT NULL DEFAULT false ,
    `createdAt` datetime NOT NULL DEFAULT CURRENT_TIMESTAMP ,
    `forceTwoFactor` boolean NOT NULL DEFAULT false ,
    `id` int NOT NULL  AUTO_INCREMENT,
    `ipRestrictions` varchar(191)   ,
    `name` varchar(191) NOT NULL  ,
    `onlyAllowDomain` boolean NOT NULL DEFAULT false ,
    `profilePicture` varchar(191) NOT NULL DEFAULT 'https://unavatar.now.sh/fallback.png' ,
    `stripeCustomerId` varchar(191)   ,
    `updatedAt` datetime(3) NOT NULL  ,
    `username` varchar(191) NOT NULL  ,
    PRIMARY KEY (`id`)
)
DEFAULT CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci

CREATE TABLE `staart`.`emails` (
    `createdAt` datetime NOT NULL DEFAULT CURRENT_TIMESTAMP ,
    `email` varchar(191) NOT NULL  ,
    `id` int NOT NULL  AUTO_INCREMENT,
    `isVerified` boolean NOT NULL DEFAULT false ,
    `updatedAt` datetime(3) NOT NULL  ,
    `userId` int NOT NULL ,
    PRIMARY KEY (`id`)
)
DEFAULT CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci

CREATE TABLE `staart`.`access-tokens` (
    `createdAt` datetime NOT NULL DEFAULT CURRENT_TIMESTAMP ,
    `description` varchar(191)   ,
    `expiresAt` datetime(3) NOT NULL  ,
    `id` int NOT NULL  AUTO_INCREMENT,
    `jwtAccessToken` varchar(191) NOT NULL  ,
    `name` varchar(191)   ,
    `scopes` varchar(191)   ,
    `updatedAt` datetime(3) NOT NULL  ,
    `userId` int NOT NULL ,
    PRIMARY KEY (`id`)
)
DEFAULT CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci

CREATE TABLE `staart`.`api-keys` (
    `createdAt` datetime NOT NULL DEFAULT CURRENT_TIMESTAMP ,
    `description` varchar(191)   ,
    `expiresAt` datetime(3) NOT NULL  ,
    `id` int NOT NULL  AUTO_INCREMENT,
    `ipRestrictions` varchar(191)   ,
    `jwtApiKey` varchar(191) NOT NULL  ,
    `name` varchar(191)   ,
    `organizationId` int NOT NULL ,
    `referrerRestrictions` varchar(191)   ,
    `scopes` varchar(191)   ,
    `updatedAt` datetime(3) NOT NULL  ,
    PRIMARY KEY (`id`)
)
DEFAULT CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci

CREATE TABLE `staart`.`approved-locations` (
    `createdAt` datetime NOT NULL DEFAULT CURRENT_TIMESTAMP ,
    `id` int NOT NULL  AUTO_INCREMENT,
    `subnet` varchar(191) NOT NULL  ,
    `userId` int NOT NULL ,
    PRIMARY KEY (`id`)
)
DEFAULT CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci

CREATE TABLE `staart`.`backup-codes` (
    `code` varchar(191) NOT NULL  ,
    `createdAt` datetime NOT NULL DEFAULT CURRENT_TIMESTAMP ,
    `id` int NOT NULL  AUTO_INCREMENT,
    `isUsed` boolean NOT NULL DEFAULT false ,
    `updatedAt` datetime(3) NOT NULL  ,
    `userId` int NOT NULL ,
    PRIMARY KEY (`id`)
)
DEFAULT CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci

CREATE TABLE `staart`.`domains` (
    `createdAt` datetime NOT NULL DEFAULT CURRENT_TIMESTAMP ,
    `domain` varchar(191) NOT NULL  ,
    `id` int NOT NULL  AUTO_INCREMENT,
    `isVerified` boolean NOT NULL DEFAULT false ,
    `organizationId` int NOT NULL ,
    `updatedAt` datetime(3) NOT NULL  ,
    `verificationCode` varchar(191) NOT NULL  ,
    PRIMARY KEY (`id`)
)
DEFAULT CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci

CREATE TABLE `staart`.`identities` (
    `createdAt` datetime NOT NULL DEFAULT CURRENT_TIMESTAMP ,
    `id` int NOT NULL  AUTO_INCREMENT,
    `identityId` varchar(191) NOT NULL  ,
    `loginName` varchar(191) NOT NULL  ,
    `type` varchar(191) NOT NULL  ,
    `updatedAt` datetime(3) NOT NULL  ,
    `userId` int NOT NULL ,
    PRIMARY KEY (`id`)
)
DEFAULT CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci

CREATE TABLE `staart`.`memberships` (
    `createdAt` datetime NOT NULL DEFAULT CURRENT_TIMESTAMP ,
    `id` int NOT NULL  AUTO_INCREMENT,
    `organizationId` int NOT NULL ,
    `role` ENUM('OWNER', 'ADMIN', 'RESELLER', 'MEMBER') NOT NULL DEFAULT 'MEMBER' ,
    `updatedAt` datetime(3) NOT NULL  ,
    `userId` int NOT NULL ,
    PRIMARY KEY (`id`)
)
DEFAULT CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci

CREATE TABLE `staart`.`sessions` (
    `city` varchar(191)   ,
    `countryCode` varchar(191)   ,
    `createdAt` datetime NOT NULL DEFAULT CURRENT_TIMESTAMP ,
    `id` int NOT NULL  AUTO_INCREMENT,
    `ipAddress` varchar(191) NOT NULL  ,
    `jwtToken` varchar(191) NOT NULL  ,
    `region` varchar(191)   ,
    `timezone` varchar(191)   ,
    `updatedAt` datetime(3) NOT NULL  ,
    `userAgent` varchar(191) NOT NULL  ,
    `userId` int NOT NULL ,
    PRIMARY KEY (`id`)
)
DEFAULT CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci

CREATE TABLE `staart`.`webhooks` (
    `contentType` varchar(191) NOT NULL DEFAULT 'application/json' ,
    `createdAt` datetime NOT NULL DEFAULT CURRENT_TIMESTAMP ,
    `event` varchar(191) NOT NULL  ,
    `id` int NOT NULL  AUTO_INCREMENT,
    `isActive` boolean NOT NULL DEFAULT false ,
    `lastFiredAt` datetime(3)   ,
    `organizationId` int NOT NULL ,
    `secret` varchar(191)   ,
    `updatedAt` datetime(3) NOT NULL  ,
    `url` varchar(191) NOT NULL  ,
    PRIMARY KEY (`id`)
)
DEFAULT CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci

CREATE UNIQUE INDEX `users.username` ON `staart`.`users`(`username`)

CREATE UNIQUE INDEX `organizations.username` ON `staart`.`organizations`(`username`)

CREATE  INDEX `userId` ON `staart`.`emails`(`userId`)

CREATE  INDEX `userId` ON `staart`.`access-tokens`(`userId`)

CREATE  INDEX `userId` ON `staart`.`backup-codes`(`userId`)

CREATE  INDEX `organizationId` ON `staart`.`domains`(`organizationId`)

CREATE  INDEX `userId` ON `staart`.`identities`(`userId`)

CREATE  INDEX `organizationId` ON `staart`.`memberships`(`organizationId`)

CREATE  INDEX `userId` ON `staart`.`memberships`(`userId`)

CREATE  INDEX `userId` ON `staart`.`sessions`(`userId`)

CREATE  INDEX `organizationId` ON `staart`.`webhooks`(`organizationId`)

ALTER TABLE `staart`.`emails` ADD FOREIGN KEY (`userId`) REFERENCES `staart`.`users`(`id`) ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE `staart`.`access-tokens` ADD FOREIGN KEY (`userId`) REFERENCES `staart`.`users`(`id`) ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE `staart`.`api-keys` ADD FOREIGN KEY (`organizationId`) REFERENCES `staart`.`organizations`(`id`) ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE `staart`.`approved-locations` ADD FOREIGN KEY (`userId`) REFERENCES `staart`.`users`(`id`) ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE `staart`.`backup-codes` ADD FOREIGN KEY (`userId`) REFERENCES `staart`.`users`(`id`) ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE `staart`.`domains` ADD FOREIGN KEY (`organizationId`) REFERENCES `staart`.`organizations`(`id`) ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE `staart`.`identities` ADD FOREIGN KEY (`userId`) REFERENCES `staart`.`users`(`id`) ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE `staart`.`memberships` ADD FOREIGN KEY (`organizationId`) REFERENCES `staart`.`organizations`(`id`) ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE `staart`.`memberships` ADD FOREIGN KEY (`userId`) REFERENCES `staart`.`users`(`id`) ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE `staart`.`sessions` ADD FOREIGN KEY (`userId`) REFERENCES `staart`.`users`(`id`) ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE `staart`.`webhooks` ADD FOREIGN KEY (`organizationId`) REFERENCES `staart`.`organizations`(`id`) ON DELETE CASCADE ON UPDATE CASCADE
```

## Changes

```diff
diff --git schema.prisma schema.prisma
migration ..20200420002856
--- datamodel.dml
+++ datamodel.dml
@@ -1,0 +1,233 @@
+generator client {
+  provider = "prisma-client-js"
+}
+
+datasource mysql {
+  provider = "mysql"
+  url      = env("DATABASE_URL")
+}
+
+enum Gender {
+  MALE
+  FEMALE
+  NONBINARY
+  UNKNOWN
+}
+
+enum NotificationEmails {
+  ACCOUNT
+  UPDATES
+  PROMOTIONS
+}
+
+enum PrefersColorScheme {
+  NO_PREFERENCE
+  LIGHT
+  DARK
+}
+
+enum PrefersReducedMotion {
+  NO_PREFERENCE
+  REDUCE
+}
+
+enum UserRole {
+  SUDO
+  USER
+}
+
+enum MembershipRole {
+  OWNER
+  ADMIN
+  RESELLER
+  MEMBER
+}
+
+model users {
+  checkLocationOnLogin Boolean              @default(false)
+  countryCode          String               @default("us")
+  createdAt            DateTime             @default(now())
+  gender               Gender               @default(UNKNOWN)
+  id                   Int                  @default(autoincrement()) @id
+  name                 String
+  nickname             String
+  notificationEmails   NotificationEmails   @default(ACCOUNT)
+  password             String?
+  prefersLanguage      String               @default("en-us")
+  prefersColorScheme   PrefersColorScheme   @default(NO_PREFERENCE)
+  prefersReducedMotion PrefersReducedMotion @default(NO_PREFERENCE)
+  primaryEmail         Int?
+  profilePicture       String               @default("https://unavatar.now.sh/fallback.png")
+  role                 UserRole             @default(USER)
+  timezone             String               @default("America/Los_Angeles")
+  twoFactorEnabled     Boolean              @default(false)
+  twoFactorSecret      String?
+  updatedAt            DateTime             @updatedAt
+  username             String               @unique
+  emails               emails[]             @relation("userEmails")
+  access_tokens        access_tokens[]      @relation("userAccessTokens")
+  approved_locations   approved_locations[] @relation("userApprovedLocations")
+  backup_codes         backup_codes[]       @relation("userBackupCodes")
+  identities           identities[]         @relation("userIdentities")
+  memberships          memberships[]        @relation("userMemberships")
+  sessions             sessions[]           @relation("userSessions")
+}
+
+model organizations {
+  autoJoinDomain   Boolean       @default(false)
+  createdAt        DateTime      @default(now())
+  forceTwoFactor   Boolean       @default(false)
+  id               Int           @default(autoincrement()) @id
+  ipRestrictions   String?
+  name             String
+  onlyAllowDomain  Boolean       @default(false)
+  profilePicture   String        @default("https://unavatar.now.sh/fallback.png")
+  stripeCustomerId String?
+  updatedAt        DateTime      @updatedAt
+  username         String        @unique
+  api_keys         api_keys[]    @relation("organizationApiKeys")
+  domains          domains[]     @relation("organizationDomains")
+  memberships      memberships[] @relation("organizationMemberships")
+  webhooks         webhooks[]    @relation("organizationWebhooks")
+}
+
+model emails {
+  createdAt  DateTime @default(now())
+  email      String
+  id         Int      @default(autoincrement()) @id
+  isVerified Boolean  @default(false)
+  updatedAt  DateTime @updatedAt
+  user       users    @relation("userEmails", fields: [userId], references: [id])
+  userId     Int
+
+  @@index([userId], name: "userId")
+}
+
+model access_tokens {
+  createdAt      DateTime @default(now())
+  description    String?
+  expiresAt      DateTime
+  id             Int      @default(autoincrement()) @id
+  jwtAccessToken String
+  name           String?
+  scopes         String?
+  updatedAt      DateTime @updatedAt
+  user           users    @relation("userAccessTokens", fields: [userId], references: [id])
+  userId         Int
+
+  @@index([userId], name: "userId")
+  @@map("access-tokens")
+}
+
+model api_keys {
+  createdAt            DateTime      @default(now())
+  description          String?
+  expiresAt            DateTime
+  id                   Int           @default(autoincrement()) @id
+  ipRestrictions       String?
+  jwtApiKey            String
+  name                 String?
+  organization         organizations @relation("organizationApiKeys", fields: [organizationId], references: [id])
+  organizationId       Int
+  referrerRestrictions String?
+  scopes               String?
+  updatedAt            DateTime      @updatedAt
+
+  @@map("api-keys")
+}
+
+model approved_locations {
+  createdAt DateTime @default(now())
+  id        Int      @default(autoincrement()) @id
+  subnet    String
+  user      users    @relation("userApprovedLocations", fields: [userId], references: [id])
+  userId    Int
+
+  @@map("approved-locations")
+}
+
+model backup_codes {
+  id        Int      @default(autoincrement()) @id
+  code      String
+  createdAt DateTime @default(now())
+  updatedAt DateTime @updatedAt
+  isUsed    Boolean  @default(false)
+  user      users    @relation("userBackupCodes", fields: [userId], references: [id])
+  userId    Int
+
+  @@index([userId], name: "userId")
+  @@map("backup-codes")
+}
+
+model domains {
+  createdAt        DateTime      @default(now())
+  domain           String
+  id               Int           @default(autoincrement()) @id
+  isVerified       Boolean       @default(false)
+  organization     organizations @relation("organizationDomains", fields: [organizationId], references: [id])
+  organizationId   Int
+  updatedAt        DateTime      @updatedAt
+  verificationCode String
+
+  @@index([organizationId], name: "organizationId")
+}
+
+model identities {
+  createdAt  DateTime @default(now())
+  id         Int      @default(autoincrement()) @id
+  identityId String
+  loginName  String
+  type       String
+  updatedAt  DateTime @updatedAt
+  user       users    @relation("userIdentities", fields: [userId], references: [id])
+  userId     Int
+
+  @@index([userId], name: "userId")
+}
+
+model memberships {
+  createdAt      DateTime       @default(now())
+  id             Int            @default(autoincrement()) @id
+  organization   organizations  @relation("organizationMemberships", fields: [organizationId], references: [id])
+  organizationId Int
+  role           MembershipRole @default(MEMBER)
+  updatedAt      DateTime       @updatedAt
+  user           users          @relation("userMemberships", fields: [userId], references: [id])
+  userId         Int
+
+  @@index([organizationId], name: "organizationId")
+  @@index([userId], name: "userId")
+}
+
+model sessions {
+  createdAt   DateTime @default(now())
+  id          Int      @default(autoincrement()) @id
+  ipAddress   String
+  jwtToken    String
+  updatedAt   DateTime @updatedAt
+  userAgent   String
+  city        String?
+  region      String?
+  timezone    String?
+  countryCode String?
+  user        users    @relation("userSessions", fields: [userId], references: [id])
+  userId      Int
+
+  @@index([userId], name: "userId")
+}
+
+model webhooks {
+  contentType    String        @default("application/json")
+  createdAt      DateTime      @default(now())
+  event          String
+  id             Int           @default(autoincrement()) @id
+  isActive       Boolean       @default(false)
+  lastFiredAt    DateTime?
+  organization   organizations @relation("organizationWebhooks", fields: [organizationId], references: [id])
+  organizationId Int
+  secret         String?
+  updatedAt      DateTime      @updatedAt
+  url            String
+
+  @@index([organizationId], name: "organizationId")
+}
```
